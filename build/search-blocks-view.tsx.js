(()=>{"use strict";var t=class{constructor(t){this.o=new Map,this.a=t}on(t,e){let s=this.o.get(t)||new Set;return this.o.set(t,s),s.add(e),()=>{this.off(t,e)}}once(t,e){let s=this.on(t,t=>{s(),e(t,this.a)});return s}off(t,e){this.o.get(t)?.delete(e)}dispose(){this.o.clear()}emit(t,e){let s=this.o.get(t);if(typeof window<"u"){let s=new CustomEvent("findkituievent",{detail:{eventName:t,data:e,instance:this.a}});window.dispatchEvent(s)}if(s)for(let t of s)t(e,this.a)}},e=class t{constructor(e){this.r=new Set,this.u=!1,this.create=t=>{if(this.u)return()=>{};let e=t();return this.r.add(e),()=>{this.r.has(e)&&(this.r.delete(e),e())}},this.child=e=>{let s=new t(()=>{this.r.delete(s.dispose),e?.()});return this.disposed?s.dispose():this.create(()=>s.dispose),s},this.dispose=()=>{this.u=!0;let t=Array.from(this.r);this.r.clear(),t.forEach(t=>t()),this.d?.()},this.d=e}get disposed(){return this.u}get size(){return this.r.size}};function s(t,e,s,i){return t.addEventListener(e,s,i),()=>{t.removeEventListener(e,s)}}var i=globalThis.document,n=t=>{throw new Error(`[findkit] Not loaded. Cannot use ${t}`)},r=(...t)=>{console.error("[findkit]",...t)};function o(t){let e="https://cdn.findkit.com/ui/v1.6.1";return t.endsWith(".js")?`${e}/esm/${t}`:`${e}/${t}`}function a(t,...e){let s="";return t.forEach((t,i)=>{s+=t+(e[i]||"")}),s}function l(t,e,n){let o=t=>{let s=(Array.isArray(t)||t instanceof NodeList?Array.from(t):[t]).filter(t=>t instanceof e);0===s.length?r("select(): No elements found with",t):n(s[0],...s.slice(1))};"string"==typeof t?function(t){"loading"!==i.readyState?t():s(i,"DOMContentLoaded",()=>{t()},{once:!0})}(()=>{o(i.querySelectorAll(t))}):o(t)}var c={css:a};function h(t){return(...e)=>{let s=c[t];return s||n(t),s(...e)}}var u={};function d(t){let e={};return new Proxy(t,{get:(t,s)=>(e[s]||(e[s]=(...e)=>{let i=t?.[s];return i||n(String(s)),i.apply(t,e)}),e[s])})}h("html"),h("h"),h("useCustomRouterData");var p=d(u);async function m(t){let e="string"==typeof t?t:t.href;if(!e)return;let n=i.createElement("link");n.rel="preload",n.as="style",n.href=e;let o=new Promise(t=>{setTimeout(t,2e3),s(n,"load",t,{once:!0}),s(n,"error",()=>{r(`Failed to load stylesheet ${e}`),t({})},{once:!0})});i.head.appendChild(n),await o,n.remove()}h("useTerms"),h("useTotal"),h("useResults"),h("useParams"),h("useGroups"),h("useTotalHitCount"),h("useLoading"),h("useInput"),h("useLang"),h("useTranslate");var f=class{constructor(s){this.c=!1,this.i=new e,this.t=function(){let e,s=new t("lazyValue");return Object.assign(t=>{void 0!==e?t(e):s.once("value",s=>{e=s.value,t(e)})},{get:()=>e,provide:t=>{if(void 0!==e)throw new Error("Value already provided");e=t,s.emit("value",{value:t})}})}(),this.loaded=!1,this.close=this.s("close"),this.setLang=this.s("setLang"),this.addTranslation=this.s("addTranslation"),this.updateGroups=this.s("updateGroups"),this.setCustomRouterData=this.s("setCustomRouterData"),this.updateParams=this.s("updateParams"),this.activateGroup=this.s("activateGroup"),this.clearGroup=this.s("clearGroup"),this.preload=async()=>{await this.l(),await new Promise(t=>{this.t(t)})},this.f=t=>{t.target instanceof HTMLAnchorElement&&(t.ctrlKey||t.shiftKey||t.metaKey||2===t.which)||(t.preventDefault(),this.toggle())};let i=s.instanceId??"fdk";this.e=s,this.n=new t(this);let n={instanceId:i,utils:d(c),preact:p,options:{...s,instanceId:i}};this.n.emit("init",n),this.e=n.options,this.emitLoadingEvents(),(this.m()||!1===s.modal||"boolean"!=typeof s.modal&&s.container)&&this.open()}emitLoadingEvents(){let t,e=this.n,s=0,i=!1,n=()=>{s++,!t&&(t=setTimeout(()=>{t=void 0,i||(i=!0,e.emit("loading",{}),this.t(t=>{t.state.loading=i}))},this.e.loadingThrottle??1e3))},r=()=>{setTimeout(()=>{s--,!(s>0)&&(clearTimeout(t),t=void 0,i&&(i=!1,e.emit("loading-done",{}),this.t(t=>{t.state.loading=i})))},10)};e.on("fetch",n),e.on("fetch-done",r),e.once("request-open",t=>{t.preloaded||(n(),e.once("loaded",r))})}get customRouterData(){let t=this.t.get();return t||n(".customRouterData â€” See https://findk.it/customRouterData"),t?.getCustomRouterData()??this.e.defaultCustomRouterData}get groups(){return this.t.get()?.getGroups()??this.e.groups??[]}get params(){return this.t.get()?.getParams()??this.e.params??{tagQuery:[]}}on(t,e){return this.n.on(t,e)}once(t,e){return this.n.once(t,e)}get usedTerms(){return this.t.get()?.state.usedTerms??""}get terms(){return this.usedTerms}get nextTerms(){return this.t.get()?.getNextTerms()??""}get status(){return this.t.get()?.state.status??"waiting"}dispose(){this.close(),this.i.dispose()}s(t){return(...e)=>{this.t(s=>{s[t](...e)})}}get id(){return this.e.instanceId??"fdk"}get separator(){return this.e.separator??"_"}get searchKey(){return this.e.searchKey??this.id+this.separator+"q"}m(){if(typeof window>"u")return!1;let t=location.search;return"hash"===this.e.router&&(t=location.hash.slice(1)),new URLSearchParams(t).has(this.searchKey)}p(){let t=[];return!this.e.load&&!1!==this.e.builtinStyles&&t.push({href:o("styles.css"),layer:"findkit.core"}),this.e.styleSheet&&t.push({href:this.e.styleSheet,layer:"findkit.user"}),t}open(t,e){this.n.emit("request-open",{preloaded:!!this.t.get()}),this.l(),this.t(s=>{s.open(t,e)})}toggle(){this.open(void 0,{toggle:!0})}search(t){this.open(t)}async h(){let t,e=Promise.all(this.p().map(m));return t=this.e.load?this.e.load():async function(t,e){let s=window,n=`${t}_promise`;if(s[n])return s[n];let r=new Promise((s,n)=>{let r=i.createElement("script");r.type="module";let o=setTimeout(()=>{n(new Error(`[findkit] Timeout loading script ${e} with ${t}`))},1e4);Object.assign(window,{[t](e){delete window[t],clearTimeout(o),r.remove(),s(e)}}),r.src=e,i.head.appendChild(r)});return s[n]=r,r}("FINDKIT_LOADED_1.6.1",o("implementation.js")).then(t=>({js:t})),await e,await t}async l(){if(this.c||this.t.get())return;let t=function(t){if(t.searchEndpoint)return t.searchEndpoint;if(t.publicToken)return function(t){let e="c",s="search",i=t.split(":",2)[1];i&&"eu-north-1"!==i&&(s=`search-${i}`);try{let t=new URLSearchParams(location.hash.slice(1));e=t.get("__findkit_version")||e,s=t.get("__findkit_subdomain")||s}catch{}return`https://${s}.findkit.com/${e}/${t}/search?p=${t}`}(t.publicToken);throw new Error("[findkit] publicToken or searchEndpoint is required")}(this.e)+"&warmup";fetch(t,{method:"POST",headers:{"Content-Type":"text/plain"},body:"{}"}).catch(()=>{}),this.c=!0;let e=await this.h();Object.assign(c,e.js),Object.assign(u,e.js.preact);let{styleSheet:s,load:i,css:n,...r}=this.e,o=this.p();e.css&&o.push({css:e.css,layer:"findkit.core"}),n&&o.push({css:n,layer:"findkit.user"});let a=t=>{this.i.create(()=>{let{engine:s,host:i}=e.js._init({...r,container:t,layeredCSS:o,instanceId:this.id,events:this.n,searchEndpoint:this.e.searchEndpoint});return this.c=!0,this.container=i,this.loaded=!0,this.t.provide(s),this.n.emit("loaded",{container:i}),s.start(),s.dispose})};this.e.container?l(this.e.container,Element,a):a()}openFrom(t){let e=this.i.child();return l(t,HTMLElement,(...t)=>{for(let i of t)e.create(()=>s(i,"click",this.f)),e.create(()=>s(i,"keydown",t=>{t.target instanceof HTMLElement&&"Enter"===t.key&&"button"===t.target.role&&(t.preventDefault(),this.toggle())})),e.create(()=>s(i,"mouseover",this.preload,{once:!0,passive:!0}));t.some(t=>t.dataset.clicked)&&this.open()}),e.dispose}bindInput(t){let e=this.i.child();return l(t,HTMLInputElement,(...t)=>{for(let i of t)e.create(()=>s(i,"focus",this.preload)),this.t(t=>{e.create(()=>t.bindInput(i))})}),e.dispose}};function g(t){return t?t.split(/,\s*|\s+/g).filter(Boolean):[]}function w(t){const e=JSON.parse(t.dataset.attributes||"{}"),s=g(e.categories),i=g(e.tags),n=g(e.postTypes),r=g(e.domains),o=g(e.rawTags);return{publicToken:e.publicToken,instanceId:e.instanceId,groupTitle:e.groupTitle,colorSlug:e.colorSlug,categories:s,tags:i,postTypes:n,domains:r,rawTags:o}}function y(t){const e=[];return t.categories.length>0&&e.push({tags:{$in:t.categories.map(t=>`wp_taxonomy/category/${t}`)}}),t.tags.length>0&&e.push({tags:{$in:t.tags.map(t=>`wp_taxonomy/post_tag/${t}`)}}),t.postTypes.length>0&&e.push({tags:{$in:t.postTypes.map(t=>`wp_post_type/${t}`)}}),t.domains.length>0&&e.push({tags:{$in:t.domains.map(t=>`domain/${t}`)}}),t.rawTags.length>0&&e.push({tags:{$in:t.rawTags}}),{$and:e}}const T=new Set;function v(t,e={}){if(!(t instanceof HTMLElement))throw new Error("Invalid container element");const s=w(t),i=s.publicToken||FINDKIT_SEARCH_BLOCK.publicToken;let n=s.instanceId||"fdk";if(!i)throw new Error("Cannot activate Findkit Search Modal. Public token is not defined in the block settings");let r,o=Array.from(t.querySelectorAll(".wp-block-findkit-search-group")).map(t=>{if(!(t instanceof HTMLElement))throw new Error("Invalid group element");const e=w(t);return{title:e.groupTitle,params:{filter:y(e)}}});0===o.length&&(o=void 0,r={filter:y(s)});let l=0;for(;T.has(n);)l++,n=`${n}${l}`;T.add(n);const c=s.colorSlug?`var(--wp--preset--color--${s.colorSlug}, #c828d2)`:"#c828d2";return new f({publicToken:i,instanceId:n,params:r,router:"hash",groups:o,css:a`
			.findkit--container {
				--findkit--brand-color: ${c};
			}
		`,...e})}for(const t of document.querySelectorAll(".wp-block-findkit-search-modal")){const e=v(t,{backdrop:!0}),s=t.querySelector(".wp-block-image img");s instanceof HTMLImageElement&&(s.role="button",s.tabIndex=0,e.openFrom(s));const i=t.querySelector(".wp-block-button a");i instanceof HTMLAnchorElement&&e.openFrom(i);const n=t.querySelector("form.wp-block-search"),r=n?.querySelector("input[type=search]");n instanceof HTMLFormElement&&r instanceof HTMLInputElement&&(r.required=!1,n.addEventListener("mouseover",()=>{e.preload()}),r.addEventListener("focus",()=>{e.preload()}),n.addEventListener("submit",t=>{t.preventDefault(),e.open(r.value)}))}for(const t of document.querySelectorAll(".wp-block-findkit-search-embed")){var k;const e=null!==(k=t.querySelector(".wp-findkit-container"))&&void 0!==k?k:void 0,s=t.querySelector("input[type=search]"),i=v(t,{header:!1,container:e,infiniteScroll:!1,minTerms:0});s instanceof HTMLInputElement&&i.bindInput(s)}})();