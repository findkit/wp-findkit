(()=>{"use strict";var e=class{constructor(e){this.o=new Map,this.i=e}on(e,t){let s=this.o.get(e)||new Set;return this.o.set(e,s),s.add(t),()=>{this.off(e,t)}}once(e,t){let s=this.on(e,(e=>{s(),t(e,this.i)}));return s}off(e,t){this.o.get(e)?.delete(t)}dispose(){this.o.clear()}emit(e,t){let s=this.o.get(e);if(typeof window<"u"){let s=new CustomEvent("findkituievent",{detail:{eventName:e,data:t,instance:this.i}});window.dispatchEvent(s)}if(s)for(let e of s)e(t,this.i)}},t=class e{constructor(t){this.r=new Set,this.c=!1,this.create=e=>{if(this.c)return()=>{};let t=e();return this.r.add(t),()=>{this.r.has(t)&&(this.r.delete(t),t())}},this.child=t=>{let s=new e((()=>{this.r.delete(s.dispose),t?.()}));return this.disposed?s.dispose():this.create((()=>s.dispose)),s},this.dispose=()=>{this.c=!0;let e=Array.from(this.r);this.r.clear(),e.forEach((e=>e())),this.d?.()},this.d=t}get disposed(){return this.c}get size(){return this.r.size}};function s(e,t,s,i){return e.addEventListener(t,s,i),()=>{e.removeEventListener(t,s)}}var i=globalThis.document,n=e=>{throw new Error(`[findkit] Not loaded. Cannot use ${e}`)},r=(...e)=>{console.error("[findkit]",...e)};function o(e){let t="https://cdn.findkit.com/ui/v1.0.3";return e.endsWith(".js")?`${t}/esm/${e}`:`${t}/${e}`}function a(e,...t){let s="";return e.forEach(((e,i)=>{s+=e+(t[i]||"")})),s}function l(e,t,n){let o=e=>{let s=(Array.isArray(e)||e instanceof NodeList?Array.from(e):[e]).filter((e=>e instanceof t));0===s.length?r("select(): No elements found with",e):n(s[0],...s.slice(1))};"string"==typeof e?function(e){"loading"!==i.readyState?e():s(i,"DOMContentLoaded",(()=>{e()}),{once:!0})}((()=>{o(i.querySelectorAll(e))})):o(e)}var c={css:a};function h(e){return(...t)=>{let s=c[e];return s||n(e),s(...t)}}var u={};function d(e){let t={};return new Proxy(e,{get:(e,s)=>(t[s]||(t[s]=(...t)=>{let i=e?.[s];return i||n(String(s)),i.apply(e,t)}),t[s])})}h("html"),h("h"),h("useCustomRouterData");var p=d(u);async function f(e){let t="string"==typeof e?e:e.href;if(!t)return;let n=i.createElement("link");n.rel="preload",n.as="style",n.href=t;let o=new Promise((e=>{setTimeout(e,2e3),s(n,"load",e,{once:!0}),s(n,"error",(()=>{r(`Failed to load stylesheet ${t}`),e({})}),{once:!0})}));i.head.appendChild(n),await o,n.remove()}h("useTerms"),h("useTotal"),h("useResults"),h("useParams"),h("useGroups"),h("useTotalHitCount"),h("useLoading"),h("useInput"),h("useLang"),h("useTranslate");var m=class{constructor(s){this.u=!1,this.a=new t,this.t=function(){let t,s=new e("lazyValue");return Object.assign((e=>{void 0!==t?e(t):s.once("value",(s=>{t=s.value,e(t)}))}),{get:()=>t,provide:e=>{if(void 0!==t)throw new Error("Value already provided");t=e,s.emit("value",{value:e})}})}(),this.close=this.s("close"),this.setLang=this.s("setLang"),this.addTranslation=this.s("addTranslation"),this.updateGroups=this.s("updateGroups"),this.setCustomRouterData=this.s("setCustomRouterData"),this.updateParams=this.s("updateParams"),this.activateGroup=this.s("activateGroup"),this.clearGroup=this.s("clearGroup"),this.preload=async()=>{await this.l(),await new Promise((e=>{this.t(e)}))},this.f=e=>{e.target instanceof HTMLAnchorElement&&(e.ctrlKey||e.shiftKey||e.metaKey||2===e.which)||(e.preventDefault(),this.toggle())};let i=s.instanceId??"fdk";this.e=s,this.n=new e(this);let n={instanceId:i,utils:d(c),preact:p,options:{...s,instanceId:i}};this.n.emit("init",n),this.e=n.options,this.emitLoadingEvents(),(this.m()||!1===s.modal||"boolean"!=typeof s.modal&&s.container)&&this.open()}emitLoadingEvents(){let e,t=this.n,s=0,i=!1,n=()=>{s++,!e&&(e=setTimeout((()=>{e=void 0,i||(i=!0,t.emit("loading",{}),this.t((e=>{e.state.loading=i})))}),this.e.loadingThrottle??1e3))},r=()=>{setTimeout((()=>{s--,!(s>0)&&(clearTimeout(e),e=void 0,i&&(i=!1,t.emit("loading-done",{}),this.t((e=>{e.state.loading=i}))))}),10)};t.on("fetch",n),t.on("fetch-done",r),t.once("request-open",(e=>{e.preloaded||(n(),t.once("loaded",r))}))}get groups(){return this.t.get()?.getGroups()??this.e.groups??[]}get params(){return this.t.get()?.getParams()??this.e.params??{tagQuery:[]}}on(e,t){return this.n.on(e,t)}once(e,t){return this.n.once(e,t)}terms(){return this.t.get()?.state.usedTerms??""}status(){return this.t.get()?.state.status??"waiting"}dispose(){this.close(),this.a.dispose()}s(e){return(...t)=>{this.t((s=>{s[e](...t)}))}}get id(){return this.e.instanceId??"fdk"}m(){if(typeof window>"u")return!1;let e=location.search;"hash"===this.e.router&&(e=location.hash.slice(1));let t=new URLSearchParams(e),s=this.e.separator??"_";return t.has(this.id+s+"q")}p(){let e=[];return!this.e.load&&!1!==this.e.builtinStyles&&e.push({href:o("styles.css"),layer:"findkit.core"}),this.e.styleSheet&&e.push({href:this.e.styleSheet,layer:"findkit.user"}),e}open(e,t){this.n.emit("request-open",{preloaded:!!this.t.get()}),this.l(),this.t((s=>{s.open(e,t)}))}toggle(){this.open(void 0,{toggle:!0})}search(e){this.open(e)}async h(){let e,t=Promise.all(this.p().map(f));return e=this.e.load?this.e.load():async function(e,t){let s=window,n=`${e}_promise`;if(s[n])return s[n];let r=new Promise(((s,n)=>{let r=i.createElement("script");r.type="module";let o=setTimeout((()=>{n(new Error(`[findkit] Timeout loading script ${t} with ${e}`))}),1e4);Object.assign(window,{[e](t){delete window[e],clearTimeout(o),r.remove(),s(t)}}),r.src=t,i.head.appendChild(r)}));return s[n]=r,r}("FINDKIT_LOADED_1.0.3",o("implementation.js")).then((e=>({js:e}))),await t,await e}async l(){if(this.u||this.t.get())return;let e=function(e){if(e.searchEndpoint)return e.searchEndpoint;if(e.publicToken)return function(e){let t="c",s="search",i=e.split(":",2)[1];i&&"eu-north-1"!==i&&(s=`search-${i}`);try{let e=new URLSearchParams(location.hash.slice(1));t=e.get("__findkit_version")||t,s=e.get("__findkit_subdomain")||s}catch{}return`https://${s}.findkit.com/${t}/${e}/search?p=${e}`}(e.publicToken);throw new Error("[findkit] publicToken or searchEndpoint is required")}(this.e)+"&warmup";fetch(e,{method:"POST",headers:{"Content-Type":"text/plain"},body:"{}"}).catch((()=>{})),this.u=!0;let t=await this.h();Object.assign(c,t.js),Object.assign(u,t.js.preact);let{styleSheet:s,load:i,css:n,...r}=this.e,o=this.p();t.css&&o.push({css:t.css,layer:"findkit.core"}),n&&o.push({css:n,layer:"findkit.user"});let a=e=>{this.a.create((()=>{let{engine:s,host:i}=t.js._init({...r,container:e,layeredCSS:o,instanceId:this.id,events:this.n,searchEndpoint:this.e.searchEndpoint});return this.u=!0,this.container=i,this.t.provide(s),this.n.emit("loaded",{container:i}),s.start(),s.dispose}))};this.e.container?l(this.e.container,Element,a):a()}openFrom(e){let t=this.a.child();return l(e,HTMLElement,((...e)=>{for(let i of e)t.create((()=>s(i,"click",this.f))),t.create((()=>s(i,"keydown",(e=>{e.target instanceof HTMLElement&&"Enter"===e.key&&"button"===e.target.role&&(e.preventDefault(),this.toggle())})))),t.create((()=>s(i,"mouseover",this.preload,{once:!0,passive:!0})));e.some((e=>e.dataset.clicked))&&this.open()})),t.dispose}bindInput(e){let t=this.a.child();return l(e,HTMLInputElement,((...e)=>{for(let i of e)t.create((()=>s(i,"focus",this.preload))),this.t((e=>{t.create((()=>e.bindInput(i)))}))})),t.dispose}};function g(e){return e?e.split(/,\s*|\s+/g).filter(Boolean):[]}function w(e){const t=JSON.parse(e.dataset.attributes||"{}"),s=g(t.categories),i=g(t.tags),n=g(t.postTypes),r=g(t.domains),o=g(t.rawTags);return{publicToken:t.publicToken,instanceId:t.instanceId,groupTitle:t.groupTitle,colorSlug:t.colorSlug,categories:s,tags:i,postTypes:n,domains:r,rawTags:o}}function y(e){const t=[];return e.categories.length>0&&t.push({tags:{$in:e.categories.map((e=>`wp_taxonomy/category/${e}`))}}),e.tags.length>0&&t.push({tags:{$in:e.tags.map((e=>`wp_taxonomy/post_tag/${e}`))}}),e.postTypes.length>0&&t.push({tags:{$in:e.postTypes.map((e=>`wp_post_type/${e}`))}}),e.domains.length>0&&t.push({tags:{$in:e.domains.map((e=>`domain/${e}`))}}),e.rawTags.length>0&&t.push({tags:{$in:e.rawTags}}),{$and:t}}const v=new Set;function T(e,t={}){if(!(e instanceof HTMLElement))throw new Error("Invalid container element");const s=w(e),i=s.publicToken||FINDKIT_SEARCH_BLOCK.publicToken;let n=s.instanceId||"fdk";if(!i)throw new Error("Cannot activate Findkit Search Modal. Public token is not defined in the block settings");let r,o=Array.from(e.querySelectorAll(".wp-block-findkit-search-group")).map((e=>{if(!(e instanceof HTMLElement))throw new Error("Invalid group element");const t=w(e);return{title:t.groupTitle,params:{filter:y(t)}}}));0===o.length&&(o=void 0,r={filter:y(s)});let l=0;for(;v.has(n);)l++,n=`${n}${l}`;v.add(n);const c=s.colorSlug?`var(--wp--preset--color--${s.colorSlug}, #c828d2)`:"#c828d2";return new m({publicToken:i,instanceId:n,params:r,router:"hash",groups:o,css:a`
			.findkit--container {
				--findkit--brand-color: ${c};
			}
		`,...t})}for(const e of document.querySelectorAll(".wp-block-findkit-search-modal")){const t=T(e,{backdrop:!0}),s=e.querySelector(".wp-block-image img");s instanceof HTMLImageElement&&(s.role="button",s.tabIndex=0,t.openFrom(s));const i=e.querySelector(".wp-block-button a");i instanceof HTMLAnchorElement&&t.openFrom(i);const n=e.querySelector("form.wp-block-search"),r=n?.querySelector("input[type=search]");n instanceof HTMLFormElement&&r instanceof HTMLInputElement&&(r.required=!1,n.addEventListener("mouseover",(()=>{t.preload()})),r.addEventListener("focus",(()=>{t.preload()})),n.addEventListener("submit",(e=>{e.preventDefault(),t.open(r.value)})))}for(const e of document.querySelectorAll(".wp-block-findkit-search-embed")){var k;const t=null!==(k=e.querySelector(".wp-findkit-container"))&&void 0!==k?k:void 0,s=e.querySelector("input[type=search]"),i=T(e,{header:!1,container:t,infiniteScroll:!1,minTerms:0});s instanceof HTMLInputElement&&i.bindInput(s)}})();